<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=0.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Quoridor" />
    <link rel="stylesheet" href="game.css">
    <title>Quoridor</title>
</head>
<body>
    <div id="game-container"></div>
    <div id="ui-overlay">
        <div class="top-bar">
            <div class="button-wrapper">
                <button id="game-info-btn">‚ÑπÔ∏è Info</button>
                <div id="game-info-popup">
                    <div id="current-player" class="player1-turn">Player 1's Turn</div>
                    <div id="fences-info">
                        <span id="player1-fences">üî¥ Player 1 (Fences: 10)</span>
                        <span id="player2-fences">üü¢ Player 2 (Fences: 10)</span>
                    </div>
                </div>
            </div>
            <button id="rules-btn">üìñ Rules</button>
            <div class="button-wrapper">
                <button id="controls-btn">‚ùì Help</button>
                <div id="controls-popup">
                    <h3>Controls</h3>
                    <p>
                        <strong>Move:</strong> Click on highlighted squares<br>
                        <strong>Place Fence:</strong> Drag fence from right panel<br>
                        <strong>Camera:</strong> Drag or scroll mouse to adjust perspective
                    </p>
                </div>
            </div>
            <button id="ai-btn">ü§ñ AI</button>
            <button id="train-btn">üéì Train</button>
            <button id="restart-game-btn">üîÑ Restart</button>
            <button id="switch-btn">üîÄ Switch</button>
        </div>
    </div>

    <!-- Fence Panel for Drag & Drop -->
    <div id="fence-panel">
        <button id="fence-panel-toggle"></button>
        <h3>üß± Fences</h3>
        <div class="fence-section" id="player1-section">
            <h4 style="color: #ff6b6b;">üî¥ Player 1</h4>
            <div class="fence-container">
                <div class="draggable-fence fence-horizontal player1-fence"
                     data-player="1" data-orientation="h"></div>
                <div class="draggable-fence fence-vertical player1-fence"
                     data-player="1" data-orientation="v"></div>
                <div class="fence-count" id="p1-fence-count">10 remaining</div>
            </div>
        </div>
        <div class="fence-section" id="player2-section">
            <h4 style="color: #4ecdc4;">üü¢ Player 2</h4>
            <div class="fence-container">
                <div class="draggable-fence fence-horizontal player2-fence"
                     data-player="2" data-orientation="h"></div>
                <div class="draggable-fence fence-vertical player2-fence"
                     data-player="2" data-orientation="v"></div>
                <div class="fence-count" id="p2-fence-count">10 remaining</div>
            </div>
        </div>
    </div>

    <!-- Drag Preview Element -->
    <div id="drag-preview"></div>

    <!-- Drop Hint -->
    <div class="drop-hint" id="drop-hint">Drop fence on the board between squares</div>

    <div id="winner-modal">
        <div id="winner-content">
            <h1 id="winner-text">üî¥Player 1 Wins!</h1>
            <button id="restart-btn">Play Again</button>
        </div>
    </div>

    <!-- Confirm Restart Dialog -->
    <div id="confirm-restart-modal">
        <div id="confirm-restart-content">
            <h2>üîÑ Restart Game?</h2>
            <p>Are you sure you want to resign and restart the game?</p>
            <div class="confirm-buttons">
                <button id="confirm-restart-yes">Yes, Restart</button>
                <button id="confirm-restart-no">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Introduction Dialog -->
    <div id="intro-modal">
        <div id="intro-content">
            <h1>üéÆ Quoridor</h1>
            <div class="intro-rules">
                <p><strong>üéØ Goal:</strong> Reach the opposite side of the board first!</p>
                <p><strong>üî¥ Player 1:</strong> Move from bottom to top</p>
                <p><strong>üü¢ Player 2:</strong> Move from top to bottom</p>
                <hr>
                <p><strong>üìç Move:</strong> Tap a highlighted square to move your pawn</p>
                <p><strong>üß± Fence:</strong> Drag a fence from the right panel onto the board to block your opponent</p>
                <p><strong>‚ö†Ô∏è Rule:</strong> You cannot completely block a player's path to the goal</p>
            </div>
            <button id="intro-start-btn">‚ñ∂Ô∏è Play</button>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="game.js"></script>
    <script>
    // Game Info Button Toggle (Popup)
    const gameInfoBtn = document.getElementById('game-info-btn');
    const gameInfoPopup = document.getElementById('game-info-popup');
    gameInfoBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        // Schlie√üe Help-Popup bevor Info-Popup ge√∂ffnet wird
        controlsPopup.classList.remove('visible');
        controlsBtn.classList.remove('active');

        gameInfoPopup.classList.toggle('visible');
        gameInfoBtn.classList.toggle('active', gameInfoPopup.classList.contains('visible'));
    });

    // Controls Button Toggle (Popup)
    const controlsBtn = document.getElementById('controls-btn');
    const controlsPopup = document.getElementById('controls-popup');
    controlsBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        // Schlie√üe Info-Popup bevor Help-Popup ge√∂ffnet wird
        gameInfoPopup.classList.remove('visible');
        gameInfoBtn.classList.remove('active');

        controlsPopup.classList.toggle('visible');
        controlsBtn.classList.toggle('active', controlsPopup.classList.contains('visible'));
    });

    // Schlie√üe Popups wenn au√üerhalb geklickt (aber nicht bei Spielfeld-Interaktion oder Fence-Panel)
    const gameContainer = document.getElementById('game-container');
    const fencePanelElement = document.getElementById('fence-panel');
    document.addEventListener('click', function(e) {
        // Nicht schlie√üen bei Klicks auf das Spielfeld oder Fence-Panel
        if (gameContainer.contains(e.target) || fencePanelElement.contains(e.target)) {
            return;
        }
        if (!gameInfoPopup.contains(e.target) && e.target !== gameInfoBtn) {
            gameInfoPopup.classList.remove('visible');
            gameInfoBtn.classList.remove('active');
        }
        if (!controlsPopup.contains(e.target) && e.target !== controlsBtn) {
            controlsPopup.classList.remove('visible');
            controlsBtn.classList.remove('active');
        }
    });

    // Fence Panel Slide Toggle
    const fencePanel = document.getElementById('fence-panel');
    const fencePanelToggle = document.getElementById('fence-panel-toggle');
    fencePanelToggle.addEventListener('click', function() {
        fencePanel.classList.toggle('open');
    });
    // Standard: Fence Panel offen
    fencePanel.classList.add('open');

    // Restart Game Button with Confirmation Dialog
    const restartGameBtn = document.getElementById('restart-game-btn');
    const confirmRestartModal = document.getElementById('confirm-restart-modal');
    const confirmRestartYes = document.getElementById('confirm-restart-yes');
    const confirmRestartNo = document.getElementById('confirm-restart-no');

    restartGameBtn.addEventListener('click', function() {
        confirmRestartModal.classList.add('visible');
    });

    confirmRestartYes.addEventListener('click', function() {
        confirmRestartModal.classList.remove('visible');
        if (typeof restartGame === 'function') {
            restartGame();
        }
    });

    confirmRestartNo.addEventListener('click', function() {
        confirmRestartModal.classList.remove('visible');
    });

    // Close modal when clicking outside
    confirmRestartModal.addEventListener('click', function(e) {
        if (e.target === confirmRestartModal) {
            confirmRestartModal.classList.remove('visible');
        }
    });

    // Introduction Modal - Play Button
    const introModal = document.getElementById('intro-modal');
    const introStartBtn = document.getElementById('intro-start-btn');

    introStartBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        e.preventDefault();
        introModal.classList.add('hidden');
    });

    // Prevent clicks on the intro modal from reaching the game
    introModal.addEventListener('click', function(e) {
        e.stopPropagation();
    });

    // Rules Button - Show intro dialog again
    const rulesBtn = document.getElementById('rules-btn');
    rulesBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        introModal.classList.remove('hidden');
    });
    </script>
</body>
</html>

